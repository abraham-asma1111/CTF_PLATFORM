<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}CTF Platform{% endblock %}</title>
  <link rel="stylesheet" href="/static/css/style.css?v=5">
  <link rel="stylesheet" href="/static/css/cyber-animations.css?v=2">
  {% block extra_css %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">
  <nav class="navbar">
    <div class="nav-container">
      <a href="{% url 'home' %}" class="nav-brand">
        ğŸš© CTF Platform
        {% if is_group_mode_active and group_event_details %}
        <span class="live-indicator-nav" id="liveIndicatorNav" style="display: none;">
          <span class="live-dot-nav"></span>
          LIVE
        </span>
        {% endif %}
      </a>
      <ul class="nav-menu">
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'challenges:list' %}">Challenges</a></li>
        <li><a href="{% url 'leaderboard:leaderboard' %}">Leaderboard</a></li>
        <li><a href="{% url 'teams:team_list' %}">Teams</a></li>
        {% if user.is_authenticated %}
        <li><a href="{% url 'users:profile' %}">Profile</a></li>
        <li><a href="{% url 'users:settings' %}">Settings</a></li>
        <li><a href="{% url 'users:logout' %}"
            style="background: #e74c3c; color: #fff; padding: 0.5rem 1rem; border-radius: 4px; font-weight: bold;">Logout</a>
        </li>
        {% else %}
        <li><a href="{% url 'users:login' %}">Login</a></li>
        <li><a href="{% url 'users:register' %}">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </nav>

  <main class="main-content">
    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Group Event Notification Banner -->
    {% if is_group_mode_active and group_event_details %}
    <div class="group-event-banner">
      <div class="group-event-content">
        <div class="group-event-icon">ğŸ†</div>
        <div class="group-event-info">
          <h3 class="group-event-title">
            {{ group_event_details.name }}
            <span class="live-indicator" id="liveIndicator" style="display: none;">
              <span class="live-dot"></span>
              LIVE
            </span>
          </h3>
          <p class="group-event-description">{{ group_event_details.description }}</p>
          <div class="group-event-stats">
            <span class="stat-item">
              <i class="icon">ğŸ¯</i>
              {{ group_event_details.total_challenges }} Challenges
            </span>
            <span class="stat-item">
              <i class="icon">ğŸ‘¥</i>
              {{ group_event_details.total_teams }} Teams Participating
            </span>
            {% if group_event_details.point_multiplier != 1.0 %}
            <span class="stat-item">
              <i class="icon">âš¡</i>
              {{ group_event_details.point_multiplier }}x Points Multiplier
            </span>
            {% endif %}
          </div>
        </div>
        <div class="group-event-actions">
          {% if user.is_authenticated %}
            {% if user_team %}
              <a href="{% url 'teams:my_team' %}" class="btn-group-event primary">
                <i class="icon">ğŸ›¡ï¸</i>
                Go to Team Section
              </a>
            {% else %}
              <div class="team-prompt">
                <p class="prompt-text">Join a team to participate!</p>
                <div class="prompt-actions">
                  <a href="{% url 'teams:team_list' %}" class="btn-group-event secondary">
                    <i class="icon">ğŸ‘¥</i>
                    Join Team
                  </a>
                  <a href="{% url 'teams:create_team' %}" class="btn-group-event primary">
                    <i class="icon">â•</i>
                    Create Team
                  </a>
                </div>
              </div>
            {% endif %}
          {% else %}
            <div class="team-prompt">
              <p class="prompt-text">Login to participate in the group competition!</p>
              <a href="{% url 'users:login' %}" class="btn-group-event primary">
                <i class="icon">ğŸ”‘</i>
                Login
              </a>
            </div>
          {% endif %}
        </div>
      </div>
      <button class="group-event-close" onclick="dismissGroupEventBanner()" title="Dismiss">
        <i class="icon">âœ•</i>
      </button>
    </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <div class="footer-container">
      <!-- Main Footer Content -->
      <div class="footer-content">
        <!-- Contact Information -->
        <div class="footer-section">
          <h3>Contact Info</h3>
          <div class="contact-info">
            <div class="contact-item">
              <span class="contact-label">Email</span>
              <a href="#" onclick="handleEmailClick(); return false;">abrahamasmamaw4@gmail.com</a>
            </div>
            <div class="contact-item">
              <span class="contact-label">Address</span>
              <span>Bahir Dar, Ethiopia</span>
            </div>
            <div class="contact-item">
              <span class="contact-label">Phone</span>
              <a href="tel:+251929744658">+251 929 744 658</a>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="footer-section">
          <h3>Links</h3>
          <ul class="footer-links">
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'challenges:list' %}">Challenges</a></li>
            <li><a href="{% url 'leaderboard:leaderboard' %}">Leaderboard</a></li>
            <li><a href="{% url 'teams:team_list' %}">Teams</a></li>
            {% if user.is_authenticated %}
            <li><a href="{% url 'users:profile' %}">Profile</a></li>
            <li><a href="{% url 'users:settings' %}">Settings</a></li>
            {% else %}
            <li><a href="{% url 'users:login' %}">Login</a></li>
            <li><a href="{% url 'users:register' %}">Register</a></li>
            {% endif %}
          </ul>
        </div>

        <!-- Social Media -->
        <div class="footer-section">
          <h3>Social Media</h3>
          <div class="social-links">
            <a href="#" onclick="alert('Twitter Coming Soon!'); return false;" class="social-link" title="Twitter">
              <span class="social-icon">ğŸ¦</span>
              <span class="social-text">Twitter</span>
            </a>
            <a href="#" onclick="alert('Instagram Coming Soon!'); return false;" class="social-link" title="Instagram">
              <span class="social-icon">ğŸ“·</span>
              <span class="social-text">Instagram</span>
            </a>
            <a href="#" onclick="alert('GitHub Coming Soon!'); return false;" class="social-link" title="GitHub">
              <span class="social-icon">ğŸ™</span>
              <span class="social-text">GitHub</span>
            </a>
            <a href="#" onclick="alert('LinkedIn Coming Soon!'); return false;" class="social-link" title="LinkedIn">
              <span class="social-icon">ğŸ’¼</span>
              <span class="social-text">LinkedIn</span>
            </a>
            <a href="#" onclick="alert('Discord Coming Soon!'); return false;" class="social-link" title="Discord">
              <span class="social-icon">ğŸ’¬</span>
              <span class="social-text">Discord</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="footer-bottom">
        <div class="footer-bottom-content">
          <p class="copyright">&copy; 2024 CTF Platform. All rights reserved.</p>
          <div class="footer-legal">
            <a href="#" onclick="alert('Privacy Policy Coming Soon!'); return false;">Privacy Policy</a>
            <span class="separator">â€¢</span>
            <a href="#" onclick="alert('Terms of Service Coming Soon!'); return false;">Terms of Service</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="/static/js/main.js"></script>
  <script src="/static/js/filter.js"></script>

  <script>
    // Smart Email Handler - Detects device and opens appropriate email interface
    function handleEmailClick() {
      const email = 'abrahamasmamaw4@gmail.com';
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

      if (isMobile) {
        // On mobile devices, use mailto to open native mail app
        window.location.href = 'mailto:' + email;
      } else {
        // On desktop, open Gmail in a new tab
        const gmailUrl = 'https://mail.google.com/mail/?view=cm&fs=1&to=' + email;
        window.open(gmailUrl, '_blank');
      }

      // Prevent default link behavior
      return false;
    }

    // Group Event Banner Functions
    function dismissGroupEventBanner() {
      const banner = document.querySelector('.group-event-banner');
      if (banner) {
        banner.classList.add('dismissed');
        // Store dismissal in localStorage to remember user preference
        localStorage.setItem('groupEventBannerDismissed', 'true');
      }
    }

    // LIVE Indicator Control (No WebSocket Required)
    {% if is_group_mode_active and group_event_details %}
    (function() {
      const eventStartTime = new Date("{{ group_event_details.start_time.isoformat }}");
      const eventEndTime = new Date("{{ group_event_details.end_time.isoformat }}");
      const liveIndicator = document.getElementById('liveIndicator');
      const liveIndicatorNav = document.getElementById('liveIndicatorNav');
      
      function updateLiveStatus() {
        const now = new Date();
        
        // Show LIVE indicator only when event is actually running
        if (now >= eventStartTime && now <= eventEndTime) {
          if (liveIndicator) {
            liveIndicator.style.display = 'inline-flex';
          }
          if (liveIndicatorNav) {
            liveIndicatorNav.style.display = 'inline-flex';
          }
        } else {
          if (liveIndicator) {
            liveIndicator.style.display = 'none';
          }
          if (liveIndicatorNav) {
            liveIndicatorNav.style.display = 'none';
          }
        }
      }
      
      // Update immediately
      updateLiveStatus();
      
      // Update every second for smooth countdown
      setInterval(updateLiveStatus, 1000);
    })();
    {% endif %}

    // Check if banner was previously dismissed
    document.addEventListener('DOMContentLoaded', function() {
      const banner = document.querySelector('.group-event-banner');
      if (banner && localStorage.getItem('groupEventBannerDismissed') === 'true') {
        banner.classList.add('dismissed');
      }
    });
  </script>

  {% block extra_js %}{% endblock %}
</body>

</html>