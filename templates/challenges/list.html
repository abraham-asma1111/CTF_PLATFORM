{% extends 'base.html' %}

{% block title %}Challenges - CTF Platform{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <h1 class="card-title">ğŸ¯ Challenges</h1>
    <p>Choose your challenge and capture the flag!</p>
    
    <!-- Optional Participation Notice for Group Events -->
    {% if is_group_mode_active and group_event_details %}
    <div class="group-participation-notice">
      <div class="notice-content">
        <div class="notice-icon">ğŸ†</div>
        <div class="notice-text">
          <strong>{{ group_event_details.name }}</strong> is currently active! 
          {% if user_team %}
            <a href="{% url 'teams:my_team' %}" class="notice-link">Access group challenges in your team section</a>
          {% else %}
            <a href="{% url 'teams:team_list' %}" class="notice-link">Join a team to participate</a>
          {% endif %}
          or continue with individual challenges below.
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h3 class="card-title">ğŸ” Filter Challenges</h3>
    <p>Filter challenges by category to find what you're looking for</p>
  </div>
  <div class="card-body">
    <div class="filter-section">
      <div class="category-filters">
        <button class="filter-btn active" data-category="all">All Categories</button>
        {% for category_code, category_name in categories %}
        <button class="filter-btn" data-category="{{ category_code }}">{{ category_name }}</button>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<div class="challenge-grid">
  {% for challenge in challenges %}
  <div class="challenge-card" data-category="{{ challenge.category }}">
    <div class="challenge-meta">
      <span class="difficulty-badge difficulty-{{ challenge.difficulty }}">{{ challenge.get_difficulty_display }}</span>
      {% if challenge.challenge_type == 'team' %}
      <span class="team-badge">ğŸ‘¥ Team Only</span>
      {% elif challenge.challenge_type == 'individual' %}
      <span class="individual-badge">ğŸ‘¤ Individual</span>
      {% endif %}
      <span class="points-badge">
        {{ challenge.points }} pts
        {% if challenge.team_points_multiplier != 1.0 %}
        <small>(Ã—{{ challenge.team_points_multiplier }} for teams)</small>
        {% endif %}
      </span>
      {% if challenge.id in user_solved %}
      <span class="solved-badge">âœ“ Solved</span>
      {% endif %}
    </div>
    <h3>{{ challenge.title }}</h3>
    <p class="challenge-category">{{ challenge.get_category_display }}</p>
    <p class="challenge-description">{{ challenge.description|truncatewords:20 }}</p>
    <div class="challenge-actions">
      {% if user.is_authenticated %}
      {% if user.is_staff or user.is_superuser %}
      <a href="{% url 'challenges:admin_detail' challenge.id %}" class="btn btn-primary">âœï¸ Edit Challenge</a>
      {% else %}
      <a href="{% url 'challenges:detail' challenge.id %}" class="btn btn-primary">
        {% if challenge.id in user_solved %}View Solution{% else %}Solve Challenge{% endif %}
      </a>
      {% endif %}
      {% else %}
      <a href="{% url 'users:login' %}" class="btn btn-secondary">Login to Solve</a>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">ğŸ“­ No Challenges</h3>
      <p>No challenges available at the moment. Check back later!</p>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
