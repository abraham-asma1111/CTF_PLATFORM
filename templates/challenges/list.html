{% extends 'base.html' %}

{% block title %}Challenges - CTF Platform{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <h1 class="card-title">üéØ Challenges</h1>
    <p>Choose your challenge and capture the flag!</p>
  </div>
</div>

<!-- Category Filter -->
<div class="filter-section">
  <div class="filter-container">
    <h3>Filter by Category</h3>
    <div class="category-filters">
      <button class="filter-btn active" data-category="all">
        All Categories
      </button>
      {% for category_code, category_name in categories %}
      <button class="filter-btn" data-category="{{ category_code }}">
        {{ category_name }}
      </button>
      {% endfor %}
    </div>
  </div>
</div>

<div class="challenge-grid">
  {% for challenge in challenges %}
  <div class="challenge-card" data-category="{{ challenge.category }}">
    <div class="challenge-meta">
      <span class="difficulty-badge difficulty-{{ challenge.difficulty }}">
        {{ challenge.get_difficulty_display }}
      </span>
      <span class="points-badge">{{ challenge.points }} pts</span>
      {% if challenge.id in user_solved %}
      <span class="solved-badge">‚úì Solved</span>
      {% endif %}
    </div>

    <h3>{{ challenge.title }}</h3>
    <p class="challenge-category">{{ challenge.get_category_display }}</p>
    <p class="challenge-description">{{ challenge.description|truncatewords:20 }}</p>

    <div class="challenge-actions">
      {% if user.is_authenticated %}
      {% if user.is_staff or user.is_superuser %}
      <a href="{% url 'challenges:admin_detail' challenge.id %}" class="btn btn-primary">
        ‚úèÔ∏è Edit Challenge
      </a>
      {% else %}
      <a href="{% url 'challenges:detail' challenge.id %}" class="btn btn-primary">
        {% if challenge.id in user_solved %}
        View Solution
        {% else %}
        Solve Challenge
        {% endif %}
      </a>
      {% endif %}
      {% else %}
      <a href="{% url 'users:login' %}" class="btn btn-secondary">Login to Solve</a>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <div class="card">
    <p>No challenges available at the moment. Check back later!</p>
  </div>
  {% endfor %}
</div>
{% endblock %}